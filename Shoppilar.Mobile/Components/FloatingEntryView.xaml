<?xml version="1.0" encoding="utf-8"?>

<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:utils="clr-namespace:Shoppilar.Mobile.Utils"
             x:Class="Shoppilar.Mobile.Components.FloatingEntryView"
             x:Name="root">

    <Border Stroke="{AppThemeBinding Light=#D0D0D0, Dark=#2A2A2A}"
            StrokeThickness="0.5"
            StrokeShape="RoundRectangle 10"
            Padding="10">

        <Grid ColumnDefinitions="*,Auto">

            <!-- Label flutuante -->
            <Label x:Name="FloatingLabel"
                   Text="{Binding Label, Source={x:Reference root}}"
                   FontSize="14"
                   TextColor="#BBB"
                   InputTransparent="True"
                   HorizontalOptions="Start"
                   VerticalOptions="Center"
                   TranslationX="2"
                   TranslationY="0"
                   AnchorX="0"
                   AnchorY="0.5" />

            <!-- Campo de entrada -->
            <Entry x:Name="InputEntry"
                   Grid.Column="0"
                   Text="{Binding Text, Source={x:Reference root}}"
                   IsPassword="{Binding IsPassword, Source={x:Reference root}}"
                   Keyboard="{Binding Keyboard, Source={x:Reference root}}"
                   IsReadOnly="{Binding IsDateMode, Source={x:Reference root}}"
                   BackgroundColor="Transparent"
                   FontSize="16"
                   Margin="0,5,0,-10"
                   TextColor="{AppThemeBinding Light=#000, Dark=#fff}"
                   Completed="OnCompleted"
                   TextChanged="OnTextChanged"
                   Focused="OnFocused"
                   Unfocused="OnUnfocused" />

            <!-- DatePicker oculto -->
            <DatePicker x:Name="HiddenDatePicker"
                        Grid.Column="0"
                        IsVisible="False"
                        Date="{Binding DateValue, Source={x:Reference root}}"
                        DateSelected="OnDateSelected" />

            <!-- Botão transparente sobre o Entry para abrir o DatePicker -->
            <Button x:Name="PickerButton"
                    Grid.Column="0"
                    BackgroundColor="Transparent"
                    IsVisible="{Binding IsDateMode, Source={x:Reference root}}"
                    Clicked="OnPickDateClicked" />

            <!-- Ícone de alternância de senha -->
            <Image x:Name="PasswordIcon"
                   Grid.Column="1"
                   VerticalOptions="Center"
                   HorizontalOptions="End"
                   Margin="8,0,0,0"
                   IsVisible="{Binding IsPassword, Source={x:Reference root}}">
                <Image.Source>
                    <FontImageSource
                        FontFamily="{x:Static utils:MaterialIcons.TypeIcon}"
                        Glyph="{x:Static utils:MaterialIcons.EyeOff}"
                        Size="25"
                        Color="{AppThemeBinding Light=#D0D0D0, Dark=#2A2A2A}" />
                </Image.Source>

                <Image.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnPasswordIconTapped" />
                </Image.GestureRecognizers>
            </Image>

        </Grid>
    </Border>
</ContentView>
